<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        body { margin: 0; }
        canvas { width: 100%; height: 100% }
    </style>
</head>

<body>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/97/three.min.js"></script>
    <script>

        THREE.TerrainLoader = function (manager) {

            this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;

        };

        THREE.TerrainLoader.prototype = {

            constructor: THREE.TerrainLoader,

            load: function (url, onLoad, onProgress, onError) {

                var scope = this;
                var request = new XMLHttpRequest();

                if (onLoad !== undefined) {

                    request.addEventListener('load', function (event) {

                        onLoad(new Uint16Array(event.target.response));
                        scope.manager.itemEnd(url);

                    }, false);

                }

                if (onProgress !== undefined) {

                    request.addEventListener('progress', function (event) {

                        onProgress(event);

                    }, false);

                }

                if (onError !== undefined) {

                    request.addEventListener('error', function (event) {

                        onError(event);

                    }, false);

                }

                if (this.crossOrigin !== undefined) request.crossOrigin = this.crossOrigin;

                request.open('GET', url, true);

                request.responseType = 'arraybuffer';

                request.send(null);

                scope.manager.itemStart(url);

            },

            setCrossOrigin: function (value) {

                this.crossOrigin = value;

            }

        };


        var scene = new THREE.Scene();
        // var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        // camera.position.set(0, -50, 50);
         var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(20, -80, 100);


        var axes = new THREE.AxisHelper(200);
        scene.add(axes);

        var renderer = new THREE.WebGLRenderer();
        renderer.setSize( window.innerWidth, window.innerHeight );


        
        var terrainLoader = new THREE.TerrainLoader();
        terrainLoader.load('../assets/ny_crop.bin', function (data) {
            console.log(data);
            var geometry = new THREE.PlaneGeometry(60, 60, 199, 199);
            // for (var i = 0, l = geometry.vertices.length; i < l; i++) {
            //     geometry.vertices[i].z = data[i] / 65535 * 10;
            // }
            // var material = new THREE.MeshPhongMaterial({
            //     color: 0xdddddd, 
            //     wireframe: true
            // });
             var material = new THREE.MeshBasicMaterial({
                color: 0x333333, 
                wireframe: true
            });

            var plane = new THREE.Mesh(geometry, material);
            scene.add(plane);
        });

        document.body.appendChild( renderer.domElement );

        function render() {
            requestAnimationFrame(render);
            renderer.render(scene, camera);
        }

        render();
    </script>
</body>

</html>